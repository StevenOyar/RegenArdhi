<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects | RegenArdhi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/projects.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/notifications.css') }}">
</head>
<body>
    <!-- Navbar -->
    <header>
        <nav class="navbar">
            <div class="logo-container">
                <span class="logo-icon">🌿</span>
                <h1 class="logo"><a href="/">RegenArdhi</a></h1>
            </div>
            <ul class="nav-links" id="navLinks">
                <li><a href="/dashboard">Dashboard</a></li>
                <li><a href="{{ url_for('projects.projects') }}" class="active">Projects</a></li>
                <li><a href="/monitoring">Monitoring</a></li>
                <li><a href="/insights">Insights</a></li>
            </ul>
            <div class="nav-actions">
                <button class="btn btn-primary" id="quickCreateBtn">
                    <i class="fas fa-plus"></i> New Project
                </button>
                <button class="btn-icon notification-btn" id="notificationBtn">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge hidden" id="notificationBadge">0</span>
                </button>
                <div class="user-menu">
                    <button class="user-btn" id="userMenuBtn">
                        <i class="fas fa-user-circle"></i>
                        <span id="userName">{{ user.first_name }}</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu" id="userDropdown">
                        <a href="/profile"><i class="fas fa-user"></i> Profile</a>
                        <a href="/settings"><i class="fas fa-cog"></i> Settings</a>
                        <a href="{{ url_for('main.logout') }}"><i class="fas fa-sign-out-alt"></i> Logout</a>
                    </div>
                </div>
            </div>
            <button class="mobile-toggle" id="mobileToggle">
                <i class="fas fa-bars"></i>
            </button>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="projects-main">
        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-content">
                <div class="hero-text">
                    <h1 class="hero-title">Your Land Restoration Projects</h1>
                    <p class="hero-subtitle">Monitor, manage, and grow your environmental impact</p>
                </div>
                <div class="hero-actions">
                    <button class="btn btn-create" onclick="openProjectModal()">
                        <i class="fas fa-plus"></i> New Project
                    </button>
                    <button class="btn btn-quick-create" onclick="handleQuickCreate()">
                        <i class="fas fa-bolt"></i> Quick Create
                    </button>
                </div>
            </div>
            <div class="hero-stats">
                <div class="hero-stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalProjects">0</div>
                        <div class="stat-label">Total Projects</div>
                    </div>
                </div>
                <div class="hero-stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-map-marked-alt"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="totalArea">0</div>
                        <div class="stat-label">Hectares</div>
                    </div>
                </div>
                <div class="hero-stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-seedling"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-number" id="activeProjects">0</div>
                        <div class="stat-label">Active</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Map Section (Collapsible) -->
        <section class="map-section collapsed" id="mapSection">
            <button class="map-toggle-btn" onclick="toggleMap()">
                <i class="fas fa-map"></i>
                <span id="mapToggleText">Show Project Map</span>
                <i class="fas fa-chevron-down" id="mapToggleIcon"></i>
            </button>
            <div class="map-container" id="mapContainer">
                <div id="projectsMap" class="map"></div>
                <div class="map-legend">
                    <div class="legend-item">
                        <span class="marker-dot planning"></span>
                        <span>Planning</span>
                    </div>
                    <div class="legend-item">
                        <span class="marker-dot active"></span>
                        <span>Active</span>
                    </div>
                    <div class="legend-item">
                        <span class="marker-dot completed"></span>
                        <span>Completed</span>
                    </div>
                    <div class="legend-item">
                        <span class="marker-dot paused"></span>
                        <span>Paused</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Recent Projects Highlight -->
        <section class="recent-projects-section" id="recentProjectsSection" style="display: none;">
            <div class="section-header-inline">
                <h2><i class="fas fa-clock"></i> Recent Projects</h2>
                <button class="btn-text" onclick="openAllProjectsPanel()">
                    <i class="fas fa-th-large"></i> See All Projects
                </button>
            </div>
            <div class="recent-projects-grid" id="recentProjectsGrid">
                <!-- Recent projects will be inserted here -->
            </div>
        </section>
    </main>

    <!-- All Projects Floating Panel -->
    <div class="all-projects-panel" id="allProjectsPanel">
        <div class="panel-overlay" onclick="closeAllProjectsPanel()"></div>
        <div class="panel-content">
            <div class="panel-header">
                <h2><i class="fas fa-seedling"></i> All Projects</h2>
                <button class="btn-close" onclick="closeAllProjectsPanel()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="panel-filters">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchProjects" placeholder="Search projects...">
                </div>
                <div class="filter-group">
                    <button class="filter-btn active" data-status="all">
                        All <span class="count" id="countAll">0</span>
                    </button>
                    <button class="filter-btn" data-status="planning">
                        Planning <span class="count" id="countPlanning">0</span>
                    </button>
                    <button class="filter-btn" data-status="active">
                        Active <span class="count" id="countActive">0</span>
                    </button>
                    <button class="filter-btn" data-status="completed">
                        Completed <span class="count" id="countCompleted">0</span>
                    </button>
                    <button class="filter-btn" data-status="paused">
                        Paused <span class="count" id="countPaused">0</span>
                    </button>
                </div>
                <select id="sortProjects" class="sort-select">
                    <option value="recent">Most Recent</option>
                    <option value="name">Name (A-Z)</option>
                    <option value="area">Area (Largest)</option>
                    <option value="progress">Progress</option>
                </select>
            </div>
            
            <div class="panel-body">
                <div id="projectsGrid" class="projects-grid">
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading projects...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-section">
                <div class="footer-logo">
                    <span class="logo-icon">🌿</span>
                    <h2>RegenArdhi</h2>
                </div>
                <p class="footer-description">Restoring land with AI, data, and community action.</p>
                <div class="footer-social">
                    <a href="#" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" title="Twitter"><i class="fab fa-x-twitter"></i></a>
                    <a href="#" title="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" title="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul class="footer-links">
                    <li><a href="/dashboard"><i class="fas fa-chart-line"></i> Dashboard</a></li>
                    <li><a href="/projects"><i class="fas fa-project-diagram"></i> Projects</a></li>
                    <li><a href="/monitoring"><i class="fas fa-satellite-dish"></i> Monitoring</a></li>
                    <li><a href="/insights"><i class="fas fa-brain"></i> Insights</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Resources</h3>
                <ul class="footer-links">
                    <li><a href="#"><i class="fas fa-book"></i> Documentation</a></li>
                    <li><a href="#"><i class="fas fa-question-circle"></i> Help Center</a></li>
                    <li><a href="#"><i class="fas fa-video"></i> Tutorials</a></li>
                    <li><a href="#"><i class="fas fa-users"></i> Community</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Contact Us</h3>
                <ul class="footer-contact">
                    <li><i class="fas fa-envelope"></i> info@regenardhi.org</li>
                    <li><i class="fas fa-phone"></i> +254 700 000 000</li>
                    <li><i class="fas fa-map-marker-alt"></i> Nairobi, Kenya</li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 RegenArdhi • Built for a Greener Future</p>
            <div class="footer-bottom-links">
                <a href="#">Privacy Policy</a>
                <a href="#">Terms of Service</a>
                <a href="#">Cookies</a>
            </div>
        </div>
    </footer>

    <!-- Create Project Modal -->
    <div class="modal" id="projectModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"><i class="fas fa-plus"></i> Create New Project</h2>
                <button class="btn-close" onclick="closeProjectModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="projectForm">
                    <input type="hidden" id="projectId" value="">
                    <div class="form-group">
                        <label><i class="fas fa-heading"></i> Project Name *</label>
                        <input type="text" id="projectName" required placeholder="e.g., Machakos Reforestation">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-tag"></i> Project Type *</label>
                            <select id="projectType" required>
                                <option value="">Select type...</option>
                                <option value="reforestation">🌲 Reforestation</option>
                                <option value="soil-conservation">🏔️ Soil Conservation</option>
                                <option value="watershed">💧 Watershed</option>
                                <option value="agroforestry">🌾 Agroforestry</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-ruler-combined"></i> Area (hectares) *</label>
                            <input type="number" id="projectArea" required step="0.1" min="0.1" placeholder="50">
                        </div>
                    </div>
                    <div class="form-group">
                        <label><i class="fas fa-align-left"></i> Description</label>
                        <textarea id="projectDescription" rows="3" placeholder="Describe your project..."></textarea>
                    </div>
                    <div class="location-section">
                        <div class="location-header">
                            <h3><i class="fas fa-map-marker-alt"></i> Location</h3>
                            <button type="button" class="btn btn-outline" onclick="useCurrentLocation()">
                                <i class="fas fa-crosshairs"></i> Use GPS
                            </button>
                        </div>
                        <div id="modalMap" class="modal-map"></div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Latitude *</label>
                                <input type="number" id="latitude" required step="0.000001" placeholder="-1.2345">
                            </div>
                            <div class="form-group">
                                <label>Longitude *</label>
                                <input type="number" id="longitude" required step="0.000001" placeholder="36.7890">
                            </div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" onclick="closeProjectModal()">Cancel</button>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-check"></i> <span id="submitBtnText">Create Project</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Project Details Modal -->
    <div class="modal" id="projectDetailsModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2 id="detailsProjectName"><i class="fas fa-info-circle"></i> Project Details</h2>
                <button class="btn-close" onclick="closeDetailsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="projectDetailsContent">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Status Change Modal -->
    <div class="modal" id="statusChangeModal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2><i class="fas fa-exchange-alt"></i> Change Project Status</h2>
                <button class="btn-close" onclick="closeStatusModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p class="status-change-info">Moving project: <strong id="statusProjectName"></strong></p>
                
                <!-- Progress Flow Visualization -->
                <div class="status-flow-container">
                    <div class="status-flow-line"></div>
                    <div class="status-flow">
                        <div class="status-option" data-status="planning" data-progress="0">
                            <div class="status-icon-wrapper">
                                <i class="fas fa-drafting-compass"></i>
                            </div>
                            <span class="status-name">Planning</span>
                            <span class="status-percentage">0%</span>
                        </div>
                        <div class="status-option" data-status="active" data-progress="50">
                            <div class="status-icon-wrapper">
                                <i class="fas fa-play-circle"></i>
                            </div>
                            <span class="status-name">Active</span>
                            <span class="status-percentage">1-99%</span>
                        </div>
                        <div class="status-option" data-status="completed" data-progress="100">
                            <div class="status-icon-wrapper">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <span class="status-name">Completed</span>
                            <span class="status-percentage">100%</span>
                        </div>
                        <div class="status-option" data-status="paused" data-progress="null">
                            <div class="status-icon-wrapper">
                                <i class="fas fa-pause-circle"></i>
                            </div>
                            <span class="status-name">Paused</span>
                            <span class="status-percentage">Hold</span>
                        </div>
                    </div>
                </div>
                
                <!-- Progress Adjustment (only shows for active status) -->
                <div class="progress-adjustment" id="progressAdjustment" style="display: none;">
                    <label for="progressSlider">
                        <i class="fas fa-sliders-h"></i> Adjust Progress: 
                        <strong id="progressValue">50</strong>%
                    </label>
                    <input type="range" id="progressSlider" min="1" max="99" value="50" class="progress-slider">
                    <div class="progress-preview">
                        <div class="progress-preview-bar">
                            <div class="progress-preview-fill" id="progressPreviewFill"></div>
                        </div>
                    </div>
                </div>
                
                <div class="status-actions">
                    <button class="btn btn-outline" onclick="closeStatusModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="confirmStatusChange()">
                        <i class="fas fa-check"></i> Confirm Change
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
    <script src="{{ url_for('static', filename='js/projects.js') }}"></script>
</body>
</html>